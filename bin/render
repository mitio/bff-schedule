#!/usr/bin/env ruby
# encoding: utf-8

require 'rubygems'
require 'bundler/setup'
require 'prawn'
require_relative '../day'
require_relative '../schedule'

if ARGV.size < 2
  puts "Usage: #{__FILE__} path-to-schedule.csv path-to-output.pdf"
  exit 1
end

input_file, output_file = ARGV
schedule = Schedule.new input_file
main_font = File.expand_path('../../fonts/DejaVuSans.ttf', __FILE__)

Prawn::Document.generate(output_file, page_size: 'A6', page_layout: :landscape) do |pdf|
  pdf.font main_font

  # First page
  pdf.font main_font, size: 20, style: :bold do
    pdf.text 'Банско филм фест', align: :center
    pdf.text '2012', align: :center
  end

  schedule.sort_by(&:starts_at).group_by(&:date).each do |date, day_events|
    day_events.group_by(&:location).each do |location, events|
      pdf.start_new_page margin: 10
      pdf.text "Location: #{location} Date: #{date} Ev: #{events.size}"
    end
  end
end

puts "Generated #{output_file}"
